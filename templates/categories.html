{% extends "base.html" %}
{% from "macros/forms.html" import render_field, render_submit %}

{% block title %}Categories - Expense Tracker{% endblock %}

{% block content %}
<div class="categories-container">
    <div class="page-header">
        <h1 class="page-title">Manage Categories</h1>
        <p class="page-subtitle">Create and organize your expense categories</p>
    </div>

    <!-- Add Category Form -->
    <div class="card category-form">
        <div class="card-header">
            <h2 class="card-title">Add New Category</h2>
        </div>
        <div class="card-body">
            <form method="POST" class="stack">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                <div class="grid grid-cols-3">
                    <div class="form-group">
                        <label for="name" class="form-label">Category Name <span class="required">*</span></label>
                        <input type="text" id="name" name="name" class="form-control" placeholder="e.g., Entertainment"
                            required maxlength="50">
                    </div>

                    <div class="form-group">
                        <label for="color" class="form-label">Color</label>
                        <input type="color" id="color" name="color" class="form-control color-picker" value="#3b82f6">
                    </div>

                    <div class="form-group">
                        <label for="icon" class="form-label">Icon</label>
                        <select id="icon" name="icon" class="form-control">
                            <option value="📁">📁 Folder</option>
                            <option value="🍕">🍕 Food</option>
                            <option value="🚗">🚗 Travel</option>
                            <option value="🛍️">🛍️ Shopping</option>
                            <option value="⚡">⚡ Utilities</option>
                            <option value="🏠">🏠 Home</option>
                            <option value="💊">💊 Health</option>
                            <option value="🎬">🎬 Entertainment</option>
                            <option value="📚">📚 Education</option>
                            <option value="💳">💳 Finance</option>
                            <option value="🎁">🎁 Gifts</option>
                            <option value="🏃">🏃 Fitness</option>
                            <option value="☕">☕ Coffee</option>
                            <option value="🍔">🍔 Fast Food</option>
                            <option value="✈️">✈️ Travel</option>
                            <option value="🎮">🎮 Gaming</option>
                            <option value="📱">📱 Technology</option>
                            <option value="👕">👕 Clothing</option>
                            <option value="🔧">🔧 Tools</option>
                            <option value="📖">📖 Books</option>
                            <option value="🎵">🎵 Music</option>
                        </select>
                    </div>
                </div>

                <div class="cluster">
                    {{ render_submit("Create Category", "btn btn-primary", "➕") }}
                </div>
            </form>
        </div>
    </div>

    <!-- Categories Grid -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Your Categories</h2>
            <div class="cluster">
                <span class="badge badge-primary">{{ categories|length }} categories</span>
            </div>
        </div>
        <div class="card-body">
            {% if categories %}
            <div class="categories-grid">
                {% for category in categories %}
                <div class="category-card" style="border-left-color: {{ category.color }}">
                    <div class="category-header">
                        <div class="category-icon">{{ category.icon }}</div>
                        <div class="category-info">
                            <h3 class="category-name">{{ category.name }}</h3>
                            <p class="category-meta">Created {{ category.created_at.strftime('%d %b %Y') }}</p>
                        </div>
                    </div>
                    <div class="category-actions">
                        <form method="POST" action="{{ url_for('delete_category', id=category.id) }}"
                            onsubmit="return confirm('Are you sure you want to delete this category? This action cannot be undone.')">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                            <button type="submit" class="btn btn-sm btn-danger" title="Delete Category">
                                🗑️
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">📁</div>
                <h3>No Categories Yet</h3>
                <p>Create your first category to start organizing your expenses.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Color picker enhancement
        const colorPicker = document.getElementById('color');
        const categoryCards = document.querySelectorAll('.category-card');

        if (colorPicker) {
            colorPicker.addEventListener('change', function () {
                // Update preview if needed
                console.log('Color selected:', this.value);
            });
        }

        // Add hover effects to category cards
        categoryCards.forEach(card => {
            card.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
            });

            card.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
            });
        });
    });
</script>
{% endblock %}